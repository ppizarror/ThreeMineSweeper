/*
 MIT
*/
function TMSMenu(){this._games={0:{enabled:!1},1:{enabled:!1},2:{fractal:!0,maxorder:2,minorder:1},3:{fractal:!0,maxorder:2,minorder:1},4:{fractal:!0,maxorder:5,minorder:2},5:{from:300,max:1200,min:50,step:50,target:!0},6:{latlng:!0,from:20,max:55,min:20,step:5},7:{latlng:!0,from:20,max:60,min:10,step:5},8:{latlng:!0,from:20,max:60,min:10,step:5},9:{latlng:!0,from:20,max:25,min:10,step:5},10:{latlng:!0,from:20,max:25,min:10,step:5},"null":{enabled:!1}};this._mines={from:5,max:25,min:5,step:1};this._gamekeys=
[3,4,2,9,6,10,7,8,5];for(var g=0;g<this._gamekeys.length;g+=1)is_null_undf(this._games[this._gamekeys[g]])||(is_null_undf(this._games[this._gamekeys[g]].fractal)&&(this._games[this._gamekeys[g]].fractal=!1),is_null_undf(this._games[this._gamekeys[g]].latlng)&&(this._games[this._gamekeys[g]].latlng=!1),is_null_undf(this._games[this._gamekeys[g]].target)&&(this._games[this._gamekeys[g]].target=!1),is_null_undf(this._games[this._gamekeys[g]].enabled)&&(this._games[this._gamekeys[g]].enabled=!0));this._cookies=
{gen:"newgame.gen",lat:"newgame.lat",lng:"newgame.lng",mines:"newgame.mines",order:"newgame.order",target:"newgame.target"};this._rippler=!1;this._dom={container:$("#menu-container"),content:$("#menu-content"),footer:$("#menu-footer"),gen_lat:null,gen_lng:null,gen_mines:null,gen_order:null,gen_selector:null,gen_target:null,generator:null,github:$("#menu-github-corner"),header:$("#menu-header"),menu:$("#menu"),mines:null,playbutton:null,subheader:$("#menu-subheader")};var a=this;this.init_menu=function(){a._dom.header.find(".menu-header-title").html(aboutinfo.productname);
a._dom.github.attr("href",aboutinfo.productwebsite);a._dom.github.attr("aria-label",lang.footer_github);var b=generateID(),c=generateID(),d=generateID();a._dom.footer.html('<div class="menu-footer-item menu-footer-item-author" id="{5}">{0}: <a href="{2}" target="_blank">@{1}</a></div><div class="menu-footer-item menu-footer-item-other"><a href="{4}" target="_blank" id="{6}"><i class="fab fa-github"></i></a></div><div class="menu-footer-item menu-footer-item-version">v{3}</div><div class="menu-footer-lang-selector menu-container-width" id="{7}"></div>'.format(lang.author_text,
aboutinfo.author.tag,aboutinfo.author.website,aboutinfo.v.version,aboutinfo.productwebsite,d,c,b));b=$("#"+b);a._write_lang(b,"en",lang.lang_en);a._write_lang(b,"es",lang.lang_es);a._write_lang(b,"br",lang.lang_br);a._write_lang(b,"fr",lang.lang_fr);a._write_lang(b,"it",lang.lang_it);a._write_lang(b,"de",lang.lang_de);a._write_lang(b,"ru",lang.lang_ru);$("#"+c).tooltipster({content:lang.footer_github,contentAsHTML:!1,delay:[1200,200],side:"bottom",theme:theme.tooltipTheme});$("#"+d).tooltipster({content:aboutinfo.author.name,
contentAsHTML:!1,delay:[1200,200],side:"bottom",theme:theme.tooltipTheme})};this._write_lang=function(b,c,d){var e=generateID();d=lang.lang_load_title.format(d);b.append('<img src="resources/langs/{1}.png" id="{0}" alt="" class="hvr-grow-shadow" />'.format(e,c));b=$("#"+e);b.on("click",function(){a._load_lang(c)});b.tooltipster({content:d,contentAsHTML:!1,delay:[1200,200],side:"bottom",theme:theme.tooltipTheme});sessionCookie.lang===c&&b.css("opacity",1)};this.main_menu=function(b){a.reset_menu();
app_console.info(lang.load_menu);b?(a._dom.container.show(),a._dom.github.show()):(a._dom.container.fadeIn(),a._dom.github.fadeIn());app_dom.window.on("resize.menucontainer",a._set_content_height);b=generateID();a._dom.content.html('<div id="{0}" class="main-button-container"></div>'.format(b));b=$("#"+b);a._add_button(lang.menu_new_game,null,b,a._menu_new);a._add_button(lang.menu_how_to_play,null,b,a._menu_htp);a._add_button(lang.menu_controls,null,b,a._menu_controls);a._add_button(lang.menu_statistics,
null,b,a._menu_stats);a._add_button(lang.menu_about,null,b,a._menu_about);a._dom.footer.find(".menu-footer-lang-selector").show();a._apply_rippler();a._set_content_height();setTimeout(function(){$(".menu-header-icon").removeClass("slideInDown");$(".menu-header-title").removeClass("fadeIn")},2500)};this._set_content_height=function(){a._dom.content.css("height",a._get_content_height());setTimeout(function(){a._dom.content.css("height",a._get_content_height())},150)};this._get_cookie_val=function(a,
c,d,e,f){a=sessionCookie[a];if(is_null_undf(a))return e;a=parseFloat(a);if(isNaN(a))return e;a=Math.max(c,Math.min(d,a));f&&(a=parseInt(a,10));return a};this._save_cookie_val=function(a,c){is_null_undf(c)||(sessionCookie[a]=c,update_session_cookie())};this._wipe_content=function(){a._dom.content.empty();a._dom.content.css("display","block");a._dom.footer.find(".menu-footer-lang-selector").hide()};this._menu_new=function(){a._wipe_content();a._write_menuback(lang.menu_new_game);var b=generateID();
a._write_input(lang.new_game_generator,'<select id="{0}"></select>'.format(b));a._dom.gen_selector=$("#"+b);a._dom.gen_selector.append('<option value="-1" disabled>{0}</option>'.format(lang.new_game_generator_select));for(b=0;b<a._gamekeys.length;b+=1)a._games[a._gamekeys[b]].enabled&&a._dom.gen_selector.append('<option value="{0}">{1}</option>'.format(a._gamekeys[b],lang["gen_"+a._gamekeys[b].toString()]));a._dom.gen_selector[0].selectedIndex=a._get_cookie_val(a._cookies.gen,0,a._gamekeys.length,
0,!0);a._dom.gen_selector.niceSelect();a._dom.gen_selector.on("change",function(b){a._load_generator_options(b.target.value);a._save_cookie_val(a._cookies.gen,a._dom.gen_selector[0].selectedIndex)});0!==a._dom.gen_selector[0].selectedIndex&&setTimeout(function(){a._dom.gen_selector.trigger("change")},250);b=generateID();a._dom.content.append('<div class="menu-generator-options" id="{0}"></div>'.format(b));a._dom.generator=$("#"+b);a._dom.playbutton=a._add_button(lang.new_game_start,"btn-primary",
null,a._play);a._dom.playbutton.attr("disabled","disabled");a._set_content_height();a._apply_rippler();a._dom.gen_selector.niceSelect("update")};this._play=function(){var b=a._dom.gen_selector.val();b=parseInt(b,10);if(a._gamekeys.includes(b)){var c=a._games[b];if(!is_null_undf(c)){var d=null,e=null,f=null,h=null;if(c.fractal){d=a._dom.gen_order.val();if(is_null_undf(d))return;d=parseInt(d,10);a._save_cookie_val(a._cookies.order,a._dom.gen_order[0].selectedIndex)}if(c.target){e=a._dom.gen_target.val();
if(is_null_undf(e))return;e=parseInt(e,10);a._save_cookie_val(a._cookies.target,e)}if(c.latlng){f=a._dom.gen_lat.val();h=a._dom.gen_lng.val();if(is_null_undf(f)||is_null_undf(h))return;f=parseInt(f,10);h=parseInt(h,10);a._save_cookie_val(a._cookies.lat,f);a._save_cookie_val(a._cookies.lng,h)}c=a._dom.gen_mines.val();is_null_undf(c)||(c=parseInt(c,10),0>c||100<c||(a._save_cookie_val(a._cookies.mines,c),a.reset_menu(),app_tms.set_generator(b,d,e,f,h),app_tms.set_mines(.01*c),app_tms.new()))}}};this._load_generator_options=
function(b){a._dom.generator.empty();a._dom.generator.removeClass("animated");a._dom.generator.removeClass("bounceInUp");b=a._games[b];if(!is_null_undf(b)){if(b.fractal){var c=generateID();a._write_input(lang.new_game_order,'<select id="{0}"></select>'.format(c),a._dom.generator);a._dom.gen_order=$("#"+c);for(c=b.minorder;c<=b.maxorder;c+=1)a._dom.gen_order.append('<option value="{0}">{1}</option>'.format(c,c));a._dom.gen_order[0].selectedIndex=this._get_cookie_val(a._cookies.order,0,b.maxorder-b.minorder,
b.maxorder-b.minorder,!0);a._dom.gen_order.niceSelect()}b.target&&(c=generateID(),a._write_input(lang.new_game_target_face,'<input id="{0}" />'.format(c),a._dom.generator),a._dom.gen_target=$("#"+c),a._dom.gen_target.ionRangeSlider({from:a._get_cookie_val(a._cookies.target,b.min,b.max,b.from,!0),max:b.max,min:b.min,skin:"round",step:b.step}));if(b.latlng){c=generateID();var d=generateID();a._write_input(lang.new_game_latlng,'<div class="menu-generator-latlng"><input id="{0}" /><div class="menu-generator-latlng-sep"></div><input id="{1}" /></div>'.format(c,
d),a._dom.generator);a._dom.gen_lat=$("#"+c);a._dom.gen_lng=$("#"+d);a._dom.gen_lat.ionRangeSlider({from:a._get_cookie_val(a._cookies.lat,b.min,b.max,b.from,!0),max:b.max,min:b.min,skin:"round",step:b.step});a._dom.gen_lng.ionRangeSlider({from:a._get_cookie_val(a._cookies.lng,b.min,b.max,b.from,!0),max:b.max,min:b.min,skin:"round",step:b.step})}c=generateID();a._write_input(lang.new_game_mines,'<input id="{0}" />'.format(c),a._dom.generator);a._dom.gen_mines=$("#"+c);a._dom.gen_mines.ionRangeSlider({from:a._get_cookie_val(a._cookies.mines,
a._mines.min,a._mines.max,a._mines.from,!0),max:a._mines.max,min:a._mines.min,skin:"round",step:a._mines.step});a._dom.generator.addClass("animated");a._dom.playbutton.removeAttr("disabled");a._set_content_height();a._dom.gen_selector.niceSelect("update")}};this._menu_htp=function(){a._wipe_content();a._write_menuback(lang.menu_how_to_play);a._add_title(lang.help_quick_start);a._write_text(lang.help_p1);a._write_text(lang.help_p2);a._write_text(lang.help_p3);a._add_title(lang.help_detailed_instructions);
a._write_list_item(lang.help_p4);a._write_list_item(lang.help_p5);a._write_list_item(lang.help_p6);a._write_list_item(lang.help_p7);a._write_list_item(lang.help_p8);a._write_list_item(lang.help_p9);a._set_content_height();a._apply_rippler()};this._menu_controls=function(){a._wipe_content();a._write_menuback(lang.menu_controls);a._write_htp_entry(["Keyboard_White_Mouse_Left"],lang.help_controls_click_faces);a._write_htp_entry(["Keyboard_White_Mouse_Left|shake-lr"],lang.help_controls_click_hold_left);
a._write_htp_entry(["Keyboard_White_Mouse_Middle"],lang.help_controls_zoom);a._write_htp_entry(["Keyboard_White_Mouse_Right"],lang.help_controls_click_right);a._write_htp_entry(["Keyboard_White_Mouse_Right|shake-lr"],lang.help_controls_click_hold_right);a._write_htp_entry(["Keyboard_White_Arrow_Up","Keyboard_White_Arrow_Left","Keyboard_White_Arrow_Down","Keyboard_White_Arrow_Right"],lang.help_controls_rotate);a._write_htp_entry(["Keyboard_White_W","Keyboard_White_A","Keyboard_White_S","Keyboard_White_D"],
lang.help_controls_move);a._write_htp_entry(["Keyboard_White_I","Keyboard_White_J","Keyboard_White_K","Keyboard_White_L"],lang.help_controls_move);a._write_htp_entry(["Keyboard_White_E","Keyboard_White_Space"],lang.help_controls_move_up);a._write_htp_entry(["Keyboard_White_Q","Keyboard_White_Shift"],lang.help_controls_move_down);a._write_htp_entry(["Keyboard_White_R"],lang.help_controls_camera_reset);a._set_content_height();a._apply_rippler()};this._menu_stats=function(){loadingHandler(!0);app_library_manager.import_async_library([app_library_manager.lib.CHARTJS,
app_library_manager.lib.JQVMAP],a._load_stats)};this._load_stats=function(){var b=$.ajax({crossOrigin:cfg_ajax_cors,data:"m=stats",timeout:cfg_href_ajax_timeout,type:"get",url:cfg_href_score});b.done(function(b){try{var c=JSON.parse(b);if(-1===Object.keys(c).indexOf("error")&&"1"===c[0].sid){a._write_stats_menu(c);return}}catch(e){app_console.exception(e)}finally{}NotificationJS.error(lang.stats_error);app_console.error(b);loadingHandler(!1)});b.fail(function(a,b,e){NotificationJS.error(lang.stats_error);
loadingHandler(!1)})};this._write_stats_menu=function(b){a._wipe_content();a._write_menuback(lang.menu_statistics);var c=Object.keys(b);a._add_title(lang.menu_stats_general_info);a._write_stats_line(lang.menu_stats_total_games,b[0].n,!0);a._write_stats_line(lang.menu_stats_total_scoreboard,b[0].sc,!0);for(var d={},e,f,h=0;h<c.length;h+=1)e=b[c[h]],f=e.c,""!==f&&"none"!==f&&(e=parseInt(e.sc,10),isNaN(e)||(d[f]=e));app_dom.body.find(".jqvmap-label").remove();a._add_title(lang.menu_stats_scoreboard_distribution);
e=generateID();a._write_text('<div id="{0}" class="menu-stats-map"></div>'.format(e));$("#"+e).vectorMap({color:"#ffffff",enableZoom:!0,hoverOpacity:.7,map:"world_en",normalizeFunction:"polynomial",scaleColors:["#C8EEFF","#006491"],selectedColor:"#666666",showTooltip:!0,values:d,onLabelShow:function(a,b,c){is_null_undf(d[c])||b.append(": {0}".format(d[c]))}});f=[];h=[];for(var g=[],m=[],k,l=0;l<c.length;l+=1)e=b[c[l]],k=e.g,""!==k&&"0"!==k&&not_null_undf(lang["gen_{0}".format(k)])&&(k=parseInt(k,
10),isNaN(k)||(h.push(lang["gen_{0}".format(k)]),g.push(parseInt(e.sc,10)),m.push(parseInt(e.n,10)),f.push(get_random_color())));b=generateID();c=generateID();a._add_title(lang.menu_stats_distribution_generator);a._write_text('<div class="menu-stat-chart"><canvas id="{0}"></canvas></div><div class="menu-stat-chart"><canvas id="{1}"></canvas></div>'.format(b,c));new Chart($("#"+b),{type:"pie",data:{datasets:[{data:m,backgroundColor:f}],labels:h},options:{legend:{position:"right"},responsive:!0,title:{display:!0,
fontSize:14,text:lang.stat_chart_games}}});new Chart($("#"+c),{type:"pie",data:{datasets:[{data:g,backgroundColor:f}],labels:h},options:{legend:{position:"right"},responsive:!0,title:{display:!0,fontSize:14,text:lang.stat_chart_scoreboard}}});a._set_content_height();a._apply_rippler();loadingHandler(!1)};this._write_text=function(b,c,d){is_null_undf(c)&&(c=0);var e="";not_null_undf(d)&&(e="font-weight: {0};".format(d));a._dom.content.append('<div class="menu-text" style="padding-left: {1}rem;{2}">{0}</div>'.format(b.replaceAll("\n",
"<br />"),c,e))};this._write_list_item=function(b){a._dom.content.append('<div class="menu-text menu-list-item">{0}</div>'.format(b))};this._add_title=function(b){a._dom.content.append('<div class="menu-title">{0}</div>'.format(b))};this._write_htp_entry=function(b,c){for(var d="",e,f=0;f<b.length;f+=1)e=b[f].split("|"),d=1===e.length?d+'<img src="resources/keys/{0}.png" class="hvr-grow" alt="" />'.format(b[f]):d+'<img src="resources/keys/{0}.png" class="hvr-grow {1}" alt="" />'.format(e[0].replaceAll(",",
" "),e[1]);a._dom.content.append('<div class="menu-htp-entry-line"><div class="menu-htp-keys">{0}</div><div class="menu-htp-text">{1}</div></div>'.format(d,c))};this._menu_about=function(){a._wipe_content();a._write_menuback(lang.menu_about);a._add_title(aboutinfo.productname);a._write_about_line(lang.author_text,'{0} <a href="{1}" target="_blank">@{2}</a>'.format(aboutinfo.author.name,aboutinfo.author.website,aboutinfo.author.tag));a._write_about_line(lang.about_version,"{0} ({1})".format(aboutinfo.v.version,
date_format(new Date(aboutinfo.v.date),cfg_date_format_public_d)));a._write_about_line(lang.about_license,"MIT");a._write_text('Copyright (c) 2019 Pablo Pizarro R.\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.',
2);a._write_about_line(lang.about_thanks_to,aboutinfo.author.contributors.join(", "));a._write_about_line(lang.about_source_code,'<a href="{0}" target="_blank">{0}</a>'.format(aboutinfo.productwebsite));a._set_content_height();a._apply_rippler()};this._write_about_line=function(b,c,d){a._dom.content.append('<div class="menu-about" style="{2}"><span class="menu-about-title">{0}:</span>{1}</div>'.format(b,c,d?"text-align:center;":""))};this._write_stats_line=function(b,c,d){a._dom.content.append('<div class="menu-stat" style="{2}"><span class="menu-stat-title">{0}:</span>{1}</div>'.format(b,
c,d?"text-align:center;":""))};this._write_input=function(b,c,d){is_null_undf(d)&&(d=a._dom.content);d.append('<div class="menu-content-input"><div class="menu-content-input-child menu-content-input-label ">{0}</div><div class="menu-content-input-child menu-content-input-content">{1}</div></div>'.format(b,c))};this._write_menuback=function(b){var c=generateID();a._dom.subheader.empty();a._dom.subheader.html('<div class="menu-subheader-container"><div class="menu-menuback-button"><button type="button" class="btn hvr-shadow rippler rippler-inverse animated fadeInLeft" id="{1}"><i class="fas fa-arrow-left"></i></button></div><div class="menu-menuback-title">{0}</div></div>'.format(b,
c));c=$("#"+c);a._dom.subheader.show();c.tooltipster({content:lang.back_to_menu,contentAsHTML:!1,delay:[1200,200],side:"bottom",theme:theme.tooltipTheme});c.on("click",function(){app_sound.play(app_sound.sound.BUTTON);a.main_menu(!0)});a._set_content_height()};this._add_button=function(b,c,d,e){is_null_undf(e)&&(e=function(){});is_null_undf(c)&&(c="btn-default");is_null_undf(d)&&(d=a._dom.content);var f=generateID();d.append('<div class="menu-main-button"><button type="button" class="btn {2} rippler rippler-inverse hvr-shadow" id="{0}">{1}</button></div>'.format(f,
b,c));b=$("#"+f);b.on("click",function(){app_sound.play(app_sound.sound.BUTTON);e()});return b};this._apply_rippler=function(){a._rippler&&$(".rippler").rippler({effectClass:"rippler-effect",effectSize:16,addElement:"div",duration:400})};this._get_content_height=function(){return a._dom.container.innerHeight()-a._dom.header.innerHeight()-a._dom.subheader.innerHeight()-get_element_height(a._dom.footer)-15};this.reset_menu=function(){a._dom.container.hide();a._dom.subheader.empty();a._dom.subheader.hide();
a._dom.github.hide();app_dom.window.off("resize.menucontainer");a._dom.content.empty();a._dom.content.css("display","inline-table");app_console.info(lang.reset_menu)};this._load_lang=function(b){sessionCookie.lang!==b&&lang_available.includes(b)&&(app_sound.play(app_sound.sound.BUTTON),sessionCookie.lang=b,update_session_cookie(),app_console.info(lang.load_lang.format(b)),app_library_manager.import_async_library(app_library_manager.lib.__LANG__,function(){check_language();lang=lang_db[b];a.init_menu();
a.main_menu(!0)},!0))}};
