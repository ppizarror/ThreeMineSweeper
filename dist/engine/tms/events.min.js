/*
 MIT
*/
function TMSEvents(){this._viewer=null;this._mouseMoveDrag=this._hasMousePressed=this._hasMouseOver=this._hasKeyPressed=!1;this._eventID={blur:"blur.canvas",click:"click.canvas",keydown:"keydown.canvas",keyup:"keyup.canvas",mousedown:"mousedown.canvas",mouseout:"mouseout.canvas",mouseover:"mouseover.canvas",mouseup:"mouseup.canvas",mousewheel:"mousewheel.canvas",wheel:"wheel.canvas",windowmousemove:"mousemove.rectzoom"};this._mouse={inside:!1,x:0,y:0};this._minesweeper=this._raycaster=this._scene=
this._canvas_parent=this._three_camera=this._volume=this._last_hover_face=null;this._altevents=!1;var a=this;this.set_viewer=function(b){a._viewer=b;a._three_camera=b.get_camera();a._canvas_parent=b.get_canvas_parent();a._scene=b.get_scene();a._raycaster=b.get_raycaster()};this.set_minesweeper=function(b){a._minesweeper=b};this.set_volume=function(b){this._volume=b};this.initEvents=function(){is_null_undf(this._canvas_parent)||(this._canvas_parent.on(a._eventID.mousewheel,function(b){stop_wheel_event(b);
b.preventDefault();a._viewer.animate_frame()}),this._canvas_parent.on(a._eventID.mousedown,function(b){b.preventDefault();a._viewer.focus();a._viewer.animate_frame();a._hasMouseOver=!0;a._hasMousePressed=!0}),this._canvas_parent.on(a._eventID.blur,function(){a._hasMousePressed=!1;a._hasKeyPressed=!1;a._viewer.stop_camera()}),this._canvas_parent.on(a._eventID.mouseover,function(){a._hasMouseOver=!0}),this._canvas_parent.on(a._eventID.mouseout,function(){a._hasMouseOver=!1}),this._canvas_parent.on(a._eventID.mousedown,
function(b){b.preventDefault();a._hasMousePressed=!0}),this._canvas_parent.on(a._eventID.click,function(b){b.preventDefault();a._viewer.objects_props.camera.movements.pan=!1;a._mouseMoveDrag||a._hasMousePressed||(a._minesweeper.play(a._last_hover_face,!0,a._viewer),b.stopPropagation())}),this._canvas_parent.on(a._eventID.mouseup,function(b){b.preventDefault();a._hasMousePressed=!1;a._mouseMoveDrag=!1;1===b.which&&(a._viewer.objects_props.camera.movements.rotate=!1);3===b.which&&(a._viewer.objects_props.camera.movements.rotate=
!1,a._mouseMoveDrag||a._hasMousePressed||(a._minesweeper.play(a._last_hover_face,!1,a._viewer),b.stopPropagation(),a._viewer.objects_props.camera.movements.pan=!1))}),app_dom.window.on(a._eventID.windowmousemove,function(b){a._mouseMoveDrag=a._hasMousePressed&&!0;a._mouseMoveDrag&&!a._viewer.objects_props.camera.movements.rotate&&1===b.which?is_null_undf(a._last_hover_face)?a._viewer.objects_props.camera.movements.rotate=!0:setTimeout(function(){a._viewer.objects_props.camera.movements.rotate=!0},
100):not_null_undf(a._last_hover_face)&&a._mouseMoveDrag&&!a._viewer.objects_props.camera.movements.pan&&3===b.which?setTimeout(function(){a._viewer.objects_props.camera.movements.pan=!0},120):(a._mouseMoveDrag&&a._faceHover(null),a._mouseHandler(b))}),this._canvas_parent.on(a._eventID.keydown,function(b){b.preventDefault();b.stopPropagation();a._hasKeyPressed=!0;if(b.altKey&&a._altevents)switch(b.which){case 49:a._viewer.toggle_gui();break;case 50:a._viewer.toggle_fps_meter();break;case 51:a._viewer.load_next_fps_info();
break;case 52:a._viewer.show_renderer_info();break;case 53:a._viewer.toggle_camera_target();break;case 54:a._viewer.toggle_planes();break;case 55:a._viewer.toggle_world_limits();break;case 56:a._viewer.toggle_axis();break;case 57:a._viewer.toggle_grid()}else{switch(b.which){case 87:a._viewer.objects_props.camera.movements.forward=!0;break;case 83:a._viewer.objects_props.camera.movements.backward=!0;break;case 65:a._viewer.objects_props.camera.movements.left=!0;break;case 68:a._viewer.objects_props.camera.movements.right=
!0;break;case 73:a._viewer.objects_props.camera.movements.planeforward=!0;break;case 75:a._viewer.objects_props.camera.movements.planebackward=!0;break;case 74:a._viewer.objects_props.camera.movements.left=!0;break;case 76:a._viewer.objects_props.camera.movements.right=!0;break;case 38:a._viewer.objects_props.camera.movements.angleup=!0;break;case 40:a._viewer.objects_props.camera.movements.angledown=!0;break;case 37:a._viewer.objects_props.camera.movements.angleleft=!0;break;case 39:a._viewer.objects_props.camera.movements.angleright=
!0;break;case 81:a._viewer.objects_props.camera.movements.zup=!0;break;case 69:a._viewer.objects_props.camera.movements.zdown=!0;break;case 82:a._viewer.reset_camera();break;case 16:a._viewer.objects_props.camera.movements.zup=!0;break;case 32:a._viewer.objects_props.camera.movements.zdown=!0;break;case 17:return}a._faceHover(null);a._viewer.objects_props.camera.movements.pan=!1;a._viewer.objects_props.camera.movements.rotate=!0}}),this._canvas_parent.on(a._eventID.keyup,function(b){b.preventDefault();
b.stopPropagation();a._hasKeyPressed=!1;switch(b.which){case 87:a._viewer.objects_props.camera.movements.forward=!1;break;case 83:a._viewer.objects_props.camera.movements.backward=!1;break;case 65:a._viewer.objects_props.camera.movements.left=!1;break;case 68:a._viewer.objects_props.camera.movements.right=!1;break;case 73:a._viewer.objects_props.camera.movements.planeforward=!1;break;case 75:a._viewer.objects_props.camera.movements.planebackward=!1;break;case 74:a._viewer.objects_props.camera.movements.left=
!1;break;case 76:a._viewer.objects_props.camera.movements.right=!1;break;case 38:a._viewer.objects_props.camera.movements.angleup=!1;break;case 40:a._viewer.objects_props.camera.movements.angledown=!1;break;case 37:a._viewer.objects_props.camera.movements.angleleft=!1;break;case 39:a._viewer.objects_props.camera.movements.angleright=!1;break;case 81:a._viewer.objects_props.camera.movements.zup=!1;break;case 69:a._viewer.objects_props.camera.movements.zdown=!1;break;case 16:a._viewer.objects_props.camera.movements.zup=
!1;break;case 32:a._viewer.objects_props.camera.movements.zdown=!1;break;case 17:a._viewer.objects_props.camera.facetarget.x=0,a._viewer.objects_props.camera.facetarget.y=0,a._viewer.objects_props.camera.facetarget.z=0}}),this._viewer.three_resize(!0))};this._mouseHandler=function(b){if(a._hasMousePressed||a._hasKeyPressed||!a._hasMouseOver||a._viewer.camera_is_moving())a._viewer.objects_props.tooltip.obj.css("display","none");else{var d=a._canvas_parent.offset(),e=a._canvas_parent.innerHeight(),
c=a._canvas_parent.innerWidth(),k=b.clientX-d.left+app_dom.window.scrollLeft(),f=b.clientY-d.top+app_dom.window.scrollTop(),g=0,h=0,l=0<=k&&k<=c&&0<=f&&f<=e;a._mouse.inside=l;a._mouse.x=k/c*2-1;a._mouse.y=2*-(f/e)+1;a._raycaster.setFromCamera(a._mouse,a._three_camera);c=a._raycaster.intersectObjects(a._scene.children,!1);if(is_null_undf(c)||0===c.length)l=!1,a._faceHover(null);else{e=f="";for(var m=0;m<a._viewer.objects_props.tooltip.modes.length;m+=1)f+=a._viewer.objects_props.tooltip.modes[m](c);
c=parseInt(f,10);isNaN(c)?this._faceHover(null):(f=this._volume.get_faces(),0<=c&&c<f.length&&(e=this._faceMouseHandler(f[c])));a._viewer.objects_props.tooltip.obj.html(e);""===e&&a._viewer.objects_props.tooltip.ignoreEmpty?l=!1:(g=a._viewer.objects_props.tooltip.obj.outerWidth(),0!==g&&g+b.clientX+a._viewer.objects_props.tooltip.left+app_dom.window.scrollLeft()>app_dom.window.width()?(a._viewer.objects_props.tooltip.obj.addClass("tooltip-left"),a._viewer.objects_props.tooltip.obj.removeClass("tooltip-right"),
h=b.clientY+a._viewer.objects_props.tooltip.top+app_dom.window.scrollTop(),g=b.clientX-a._viewer.objects_props.tooltip.left+app_dom.window.scrollLeft()-g):(a._viewer.objects_props.tooltip.obj.addClass("tooltip-right"),a._viewer.objects_props.tooltip.obj.removeClass("tooltip-left"),h=app_dom.window.width(),e=app_dom.root.outerWidth(),g=k+a._viewer.objects_props.tooltip.left+d.left,h>e&&(g-=(h-e)/2),h=b.clientY+a._viewer.objects_props.tooltip.top+app_dom.window.scrollTop()))}a._viewer.objects_props.tooltip.obj.css({display:l?
"block":"none",left:g,top:h})}};this._faceMouseHandler=function(b){this._faceHover(b);return""};this._faceHover=function(b){if(!is_null_undf(b)||!is_null_undf(a._last_hover_face)){if(is_null_undf(b)&&not_null_undf(a._last_hover_face)||not_null_undf(b)&&not_null_undf(a._last_hover_face)&&!b.equals(a._last_hover_face)){var d=a._last_hover_face.get_mesh();a._last_hover_face.is_played()?d.material.emissive=a._viewer.palette.face_unhover_played:d.material.emissive=a._viewer.palette.face_unhover_unplayed;
a._last_hover_face=null;a._viewer.objects_props.camera.facetarget.nullface=!0;a._viewer.objects_props.camera.facetarget.x=0;a._viewer.objects_props.camera.facetarget.y=0;a._viewer.objects_props.camera.facetarget.z=0;if(is_null_undf(b)){this._viewer.render();return}}b.is_enabled()&&(d=b.get_mesh(),b.is_played()?d.material.emissive=a._viewer.palette.face_hover_played:d.material.emissive=a._viewer.palette.face_hover_unplayed,a._last_hover_face=b,b=b.get_center_coords(),a._viewer.objects_props.camera.facetarget.x=
b.x,a._viewer.objects_props.camera.facetarget.y=b.y,a._viewer.objects_props.camera.facetarget.z=b.z,this._viewer.render())}}};
