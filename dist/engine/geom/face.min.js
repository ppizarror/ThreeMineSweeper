/*
 MIT
*/
function Face(r,t){this._id=generateID();this._vertex=[];this._volumes=[];this._name="";this._assembled=!1;this._neighbours=null;this._uv_rotation=0;this._uv_flip=!1;this._uv_scale=1;this._uv_center=new THREE.Vector2(.5,.5);this._uv_traslate=new THREE.Vector2(0,0);this._mesh=null;this._draw_contour=!0;const g=this;this.get_id=function(){return this._id};this.equals=function(a){return this._id===a._id};this.add_vertex=function(a){if(is_null_undf(a))return!1;if(a instanceof Array){let b=!0;for(let c=
0;c<a.length;c+=1)b=b&&this.add_vertex(a[c]);return b}if(this.has_vertex(a))return!1;this._vertex.push(a);a.add_face(this);g._assembled=!1;return!0};this.has_vertex=function(a){if(a instanceof Array){var b=!0;for(let c=0;c<a.length;c+=1)b=b&&this.has_vertex(a[c]);return b}for(b=0;b<this._vertex.length;b+=1)if(this._vertex[b].equals(a))return!0;return!1};this.remove_vertex=function(a){if(a instanceof Array)for(var b=0;b<a.length;b+=1)this.remove_vertex(a[b]);else for(b=0;b<this._vertex.length;b+=1)if(this._vertex[b].equals(a)){this._vertex.splice(b,
1);g._assembled=!1;break}};this.reverse_vertices=function(){this._vertex.reverse()};this.push_right=function(){let a=this._vertex.shift();this._vertex.push(a)};this.push_left=function(){let a=this._vertex.pop();this._vertex.unshift(a)};this.length=function(){return this._vertex.length};this.is_ccw=function(){if(this._vertex.length<3)return!1;for(let a=0;a<this._vertex.length;a+=1){let b=this._vertex[a%this._vertex.length],c=this._vertex[(a+1)%this._vertex.length],e=this._vertex[(a+2)%this._vertex.length];
if(!b.collinear(c,e)&&!b.ccw(c,e))return!1}return!0};this.is_planar=function(){if(this._vertex.length<3)return!1;var a=this.get_normal();a.normalize();let b=a.getComponent(0),c=a.getComponent(1),e=a.getComponent(2);for(let d=1;d<this._vertex.length;d+=1){a=this._vertex[d%this._vertex.length];let f=this._vertex[(d+1)%this._vertex.length],h=this._vertex[(d+2)%this._vertex.length];if(!a.collinear(f,h)&&(a=this._normal(a,f,h),a.normalize(),a.getComponent(0)!==b||a.getComponent(1)!==c||a.getComponent(2)!==
e))return!1}return!0};this._normal=function(a,b,c){let e=b.get_x()-a.get_x(),d=b.get_y()-a.get_y();a=b.get_z()-a.get_z();let f=c.get_x()-b.get_x(),h=c.get_y()-b.get_y();b=c.get_z()-b.get_z();return new THREE.Vector3(d*b-a*h,-(e*b-a*f),e*h-d*f)};this.get_normal=function(){for(let a=0;a<this._vertex.length;a+=1){let b=this._vertex[a%this._vertex.length],c=this._vertex[(a+1)%this._vertex.length],e=this._vertex[(a+2)%this._vertex.length];if(!b.collinear(c,e))return this._normal(b,c,e)}return null};this.set_name=
function(a){is_null_undf(a)||(g._name=a)};this.get_name=function(){return this._name};this.is_valid=function(){return this.is_cartesian_plane()===this.is_ccw()&&this.is_planar()||this.is_ccw()&&this.is_planar()};this.get_area=function(){if(!this.is_valid())return-1;let a=this._vertex[0],b=0;for(let c=0;c<this._vertex.length;c+=1)b+=a.area2(this._vertex[c%this._vertex.length],this._vertex[(c+1)%this._vertex.length]);return b};this.get_perimeter=function(){if(!this.is_valid())return-1;let a=0;for(let b=
0;b<this._vertex.length;b+=1)a+=this._vertex[b%this._vertex.length].dist(this._vertex[(b+1)%this._vertex.length]);return a};this.scale=function(a,b,c,e){is_null_undf(b)&&(b=1);is_null_undf(c)&&(c=1);is_null_undf(e)&&(e=1);for(let d=0;d<this._vertex.length;d+=1)this._vertex[d].scale(a,b,c,e)};this.translate=function(a,b,c){is_null_undf(a)&&(a=0);is_null_undf(b)&&(b=0);is_null_undf(c)&&(c=0);for(let e=0;e<this._vertex.length;e+=1)this._vertex[e].translate(a,b,c)};this.get_next_vertex=function(a){for(let b=
0;b<this._vertex.length;b+=1)if(this._vertex[b].equals(a))return this._vertex[(b+1)%this._vertex.length];return null};this.get_prev_vertex=function(a){for(let b=0;b<this._vertex.length;b+=1)if(this._vertex[b].equals(a))return a=b-1,a<0&&(a=this._vertex.length-1),this._vertex[a];return null};this.get_neighbours=function(){let a=[],b=[];for(let c=0;c<this._vertex.length;c+=1){let e=this._vertex[c],d=e.get_faces();for(let f=0;f<d.length;f+=1)d[f].equals(this)||!this.has_vertex(e.next(d[f]))&&!this.has_vertex(e.prev(d[f]))||
b.includes(d[f].get_id())||(a.push(d[f]),b.push(d[f].get_id()))}return a};this.get_faces_around=function(){let a=[],b=[];for(let c=0;c<this._vertex.length;c+=1){let e=this._vertex[c].get_faces();for(let d=0;d<e.length;d+=1)e[d].equals(this)||b.includes(e[d].get_id())||(a.push(e[d]),b.push(e[d].get_id()))}return a};this.get_neighbours_strlist=function(){let a="",b=this.get_neighbours();for(let c=0;c<b.length;c+=1)a+=b[c].get_name(),c<b.length-1&&(a+=", ");return a};this.assemble=function(){g._assembled||
(g._assembled=!0,g._neighbours=this.get_neighbours())};this.is_neighbour=function(a,b){this._assembled||this.assemble();if(a instanceof Array){b=!0;for(let c=0;c<a.length;c+=1)b=b&&this.is_neighbour(a[c],!1);return b&&a.length===this._neighbours.length}if(b)return this._neighbours.length===1&&this._neighbours[0].equals(a);for(b=0;b<this._neighbours.length;b+=1)if(this._neighbours[b].equals(a))return!0;return!1};this.get_total_neighbours=function(){this._assembled||this.assemble();return this._neighbours.length};
this.is_cartesian_plane=function(){var a=this.get_normal();let b=a.getComponent(0),c=a.getComponent(1);a=a.getComponent(2);return b!==0&&c===0&&a===0||b===0&&c!==0&&a===0||b===0&&c===0&&a!==0};this.get_vertices=function(){return this._vertex.slice(0)};this.get_threejs_points=function(a){let b=[];for(let c=0;c<this.length();c+=1)b.push(this._vertex[c].get_pos(a));return b};this.generate_geometry=function(){let a=new THREE.Geometry,b=this.get_normal();b.normalize();if(this.length()===3){var c=[0,1,
2];var e=1}else{c=[];e=this.get_threejs_points(!1);var d=new THREE.Vector3(0,0,1);let k=(new THREE.Quaternion).setFromUnitVectors(b,d),n=(new THREE.Quaternion).setFromUnitVectors(d,b);e.forEach(l=>{l.applyQuaternion(k)});let m,p;var f=d=0;let q=0;for(let l=0;l<e.length;l+=1){var h=e[l].getComponent(0);m=e[l].getComponent(1);p=e[l].getComponent(2);d=Math.min(h,d);f=Math.min(m,f);q=Math.min(p,q);c.push(h);c.push(m);c.push(p)}for(h=0;h<e.length;h+=1)c[3*h]-=d,c[3*h+1]-=f,c[3*h+2]-=q;d=Math.abs(get_max_of_array(c));
for(f=0;f<c.length;f+=1)c[f]/=d;e.forEach(l=>{l.applyQuaternion(n)});c=earcut(c,null,3);e=c.length/3}if(e>0){for(d=0;d<this._vertex.length;d+=1)a.vertices.push(this._vertex[d].get_pos(!0));for(d=0;d<e;d+=1)a.faces.push(new THREE.Face3(c[3*d+2],c[3*d+1],c[3*d],b))}a.computeFaceNormals();a.computeVertexNormals();this._boxUnwrapUVs(a);return a};this._boxUnwrapUVs=function(a){a.boundingBox||a.computeBoundingBox();let b=a.boundingBox.getSize(new THREE.Vector3),c=a.boundingBox.min;if(a.faceVertexUvs[0].length===
0)for(var e=0;e<a.faces.length;e+=1)a.faceVertexUvs[0].push([new THREE.Vector2,new THREE.Vector2,new THREE.Vector2]);for(e=0;e<a.faces.length;e+=1){let h=a.faceVertexUvs[0][e],k=a.vertices[a.faces[e].a],n=a.vertices[a.faces[e].b],m=a.vertices[a.faces[e].c];var d=(new THREE.Vector3).copy(n).sub(k),f=(new THREE.Vector3).copy(m).sub(k);d=(new THREE.Vector3).copy(d).cross(f);d.set(Math.abs(d.x),Math.abs(d.y),Math.abs(d.z));f=d.x>d.y?d.x>d.z?"x":d.y>d.z?"y":d.y>d.z:d.y>d.z?"y":"z";d=f==="x"?"y":"x";f=
f==="x"?"z":f==="y"?"z":"y";this._uv_flip?(h[0].set((k[f]-c[f])/b[f],(k[d]-c[d])/b[d]),h[1].set((n[f]-c[f])/b[f],(n[d]-c[d])/b[d]),h[2].set((m[f]-c[f])/b[f],(m[d]-c[d])/b[d])):(h[0].set((k[d]-c[d])/b[d],(k[f]-c[f])/b[f]),h[1].set((n[d]-c[d])/b[d],(n[f]-c[f])/b[f]),h[2].set((m[d]-c[d])/b[d],(m[f]-c[f])/b[f]));h[0].rotateAround(this._uv_center,this._uv_rotation);h[1].rotateAround(this._uv_center,this._uv_rotation);h[2].rotateAround(this._uv_center,this._uv_rotation);h[0].multiplyScalar(this._uv_scale);
h[1].multiplyScalar(this._uv_scale);h[2].multiplyScalar(this._uv_scale);h[0].add(this._uv_traslate);h[1].add(this._uv_traslate);h[2].add(this._uv_traslate)}a.elementsNeedUpdate=!0;a.verticesNeedUpdate=!0};this.remove=function(){for(let a=0;a<this._vertex.length;a+=1)this._vertex[a].remove_face(this)};this.check_vertices=function(){for(let a=0;a<this._vertex.length;a+=1)this._vertex[a].add_face(this)};this.add_volume=function(a){if(this.has_volume(a))return!1;this._volumes.push(a);return!0};this.has_volume=
function(a){for(let b=0;b<this._volumes.length;b+=1)if(this._volumes[b].equals(a))return!0;return!1};this.remove_volume=function(a){for(let b=0;b<this._volumes.length;b+=1)if(this._volumes[b].equals(a))return this._volumes.splice(b,1),!0;return!1};this.replace_vertex=function(a,b){for(let c=0;c<this._vertex.length;c+=1)if(this._vertex[c].equals(a))return this._vertex[c]=b,!0;return!1};this.set_uv_rotation=function(a){g._uv_rotation=a*Math.PI/180};this.enable_uv_flip=function(){g._uv_flip=!0};this.set_uv_scale=
function(a){a===0||a<0||(g._uv_scale=a)};this.set_uv_translate=function(a,b){g._uv_traslate.setX(-a);g._uv_traslate.setY(-b)};this.set_mesh=function(a){g._mesh=a};this.get_mesh=function(){return this._mesh};this._bomb=0;this._enabled=!0;this._played=!1;this._flag=0;this.behaviour={AROUND:1,NEIGHBOUR:0};this._bomb_behaviour=this.behaviour.NEIGHBOUR;this._exploded_secondary=this._exploded=!1;this.place_bomb=function(){g._bomb=-1};this.has_bomb=function(){return g._bomb===-1};this.set_bomb_count=function(a){g._bomb=
a};this.set_bomb_behaviour=function(a){g._bomb_behaviour=a};this.get_bomb_count=function(){if(!this.is_enabled())return 0;let a;if(this._bomb_behaviour===this.behaviour.NEIGHBOUR)a=this.get_neighbours();else if(this._bomb_behaviour===this.behaviour.AROUND)a=this.get_faces_around();else return 0;let b=0,c;for(let e=0;e<a.length;e+=1)c=a[e],c.has_bomb()&&(b+=1);return b};this.disable_face=function(){g._enabled=!1};this.is_enabled=function(){return this._enabled};this.get_image=function(a,b){is_null_undf(b)&&
(b="");return this.is_enabled()?this._flag===1?a.images["flag"+b]:this._flag===2?a.images["question"+b]:this._played?this.has_bomb()?a.images["bomb"+b]:a.images["tile_"+g._bomb+b]:a.images["unopened"+b]:a.images["disabled"+b]};this.place_image=function(a){this._mesh.material.aoMap=this.get_image(a,"_ambient");this._mesh.material.bumpMap=this.get_image(a,"_normal");this._mesh.material.map=this.get_image(a,"");this._mesh.material.specularMap=this.get_image(a,"_specular")};this.play=function(a){g._played=
!0;g._mesh.material.color=a.palette.face_color_played;g._mesh.material.emissive=a.palette.face_unhover_played;g._mesh.material.shininess=a.palette.face_shininess_played};this.is_played=function(){return g._played||!g._enabled};this.get_target_faces=function(){switch(this._bomb_behaviour){case this.behaviour.NEIGHBOUR:return this.get_neighbours();case this.behaviour.AROUND:return this.get_faces_around();default:return[]}};this.place_flag=function(){g._flag=(g._flag+1)%3};this.has_flag=function(){return g._flag===
1};this.has_question=function(){return g._flag===2};this.explode=function(a){g._exploded=!0;g.play(a);g.place_image(a)};this.has_exploded=function(){return this._exploded};this.explode_secondary=function(a){g._exploded_secondary=!0;g._mesh.material.color=a.palette.face_exploded};this.has_exploded_secondary=function(){return g._exploded_secondary};this.get_center_coords=function(){let a={x:0,y:0,z:0},b=g._vertex[0].get_x(),c=b,e=g._vertex[0].get_y(),d=e,f=g._vertex[0].get_z(),h=f;for(let k=1;k<g._vertex.length;k+=
1)b=Math.min(b,g._vertex[k].get_x()),e=Math.min(e,g._vertex[k].get_y()),f=Math.min(f,g._vertex[k].get_z()),c=Math.max(c,g._vertex[k].get_x()),d=Math.max(d,g._vertex[k].get_y()),h=Math.max(h,g._vertex[k].get_z());a.x=b+(c-b)/2;a.y=e+(d-e)/2;a.z=f+(h-f)/2;return a};this.disable_contour=function(){g._draw_contour=!1};this.has_contour=function(){return g._draw_contour};this.add_vertex(r);this.set_name(t)};
