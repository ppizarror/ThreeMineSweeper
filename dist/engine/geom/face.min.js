/*
 MIT
*/
function Face(t,u){this._id=generateID();this._vertex=[];this._volumes=[];this._name="";this._assembled=!1;this._neighbours=null;this._uv_rotation=0;this._uv_flip=!1;this._uv_scale=1;this._uv_center=new THREE.Vector2(.5,.5);this._uv_traslate=new THREE.Vector2(0,0);this._mesh=null;this._draw_contour=!0;var f=this;this.get_id=function(){return this._id};this.equals=function(a){return this._id===a._id};this.add_vertex=function(a){if(is_null_undf(a))return!1;if(a instanceof Array){for(var b=!0,c=0;c<
a.length;c+=1)b=b&&this.add_vertex(a[c]);return b}if(this.has_vertex(a))return!1;this._vertex.push(a);a.add_face(this);f._assembled=!1;return!0};this.has_vertex=function(a){if(a instanceof Array){for(var b=!0,c=0;c<a.length;c+=1)b=b&&this.has_vertex(a[c]);return b}for(b=0;b<this._vertex.length;b+=1)if(this._vertex[b].equals(a))return!0;return!1};this.remove_vertex=function(a){if(a instanceof Array)for(var b=0;b<a.length;b+=1)this.remove_vertex(a[b]);else for(b=0;b<this._vertex.length;b+=1)if(this._vertex[b].equals(a)){this._vertex.splice(b,
1);f._assembled=!1;break}};this.reverse_vertices=function(){this._vertex.reverse()};this.push_right=function(){var a=this._vertex.shift();this._vertex.push(a)};this.push_left=function(){var a=this._vertex.pop();this._vertex.unshift(a)};this.length=function(){return this._vertex.length};this.is_ccw=function(){if(3>this._vertex.length)return!1;for(var a=0;a<this._vertex.length;a+=1){var b=this._vertex[a%this._vertex.length],c=this._vertex[(a+1)%this._vertex.length],e=this._vertex[(a+2)%this._vertex.length];
if(!b.collinear(c,e)&&!b.ccw(c,e))return!1}return!0};this.is_planar=function(){if(3>this._vertex.length)return!1;var a=this.get_normal();a.normalize();for(var b=a.getComponent(0),c=a.getComponent(1),e=a.getComponent(2),d=1;d<this._vertex.length;d+=1){a=this._vertex[d%this._vertex.length];var h=this._vertex[(d+1)%this._vertex.length],m=this._vertex[(d+2)%this._vertex.length];if(!a.collinear(h,m)&&(a=this._normal(a,h,m),a.normalize(),a.getComponent(0)!==b||a.getComponent(1)!==c||a.getComponent(2)!==
e))return!1}return!0};this._normal=function(a,b,c){var e=b.get_x()-a.get_x(),d=b.get_y()-a.get_y();a=b.get_z()-a.get_z();var h=c.get_x()-b.get_x(),m=c.get_y()-b.get_y();b=c.get_z()-b.get_z();return new THREE.Vector3(d*b-a*m,-(e*b-a*h),e*m-d*h)};this.get_normal=function(){for(var a=0;a<this._vertex.length;a+=1){var b=this._vertex[a%this._vertex.length],c=this._vertex[(a+1)%this._vertex.length],e=this._vertex[(a+2)%this._vertex.length];if(!b.collinear(c,e))return this._normal(b,c,e)}return null};this.set_name=
function(a){is_null_undf(a)||(f._name=a)};this.get_name=function(){return this._name};this.is_valid=function(){return this.is_cartesian_plane()===this.is_ccw()&&this.is_planar()||this.is_ccw()&&this.is_planar()};this.get_area=function(){if(!this.is_valid())return-1;for(var a=this._vertex[0],b=0,c=0;c<this._vertex.length;c+=1)b+=a.area2(this._vertex[c%this._vertex.length],this._vertex[(c+1)%this._vertex.length]);return b};this.get_perimeter=function(){if(!this.is_valid())return-1;for(var a=0,b=0;b<
this._vertex.length;b+=1)a+=this._vertex[b%this._vertex.length].dist(this._vertex[(b+1)%this._vertex.length]);return a};this.scale=function(a,b,c,e){is_null_undf(b)&&(b=1);is_null_undf(c)&&(c=1);is_null_undf(e)&&(e=1);for(var d=0;d<this._vertex.length;d+=1)this._vertex[d].scale(a,b,c,e)};this.translate=function(a,b,c){is_null_undf(a)&&(a=0);is_null_undf(b)&&(b=0);is_null_undf(c)&&(c=0);for(var e=0;e<this._vertex.length;e+=1)this._vertex[e].translate(a,b,c)};this.get_next_vertex=function(a){for(var b=
0;b<this._vertex.length;b+=1)if(this._vertex[b].equals(a))return this._vertex[(b+1)%this._vertex.length];return null};this.get_prev_vertex=function(a){for(var b=0;b<this._vertex.length;b+=1)if(this._vertex[b].equals(a))return a=b-1,0>a&&(a=this._vertex.length-1),this._vertex[a];return null};this.get_neighbours=function(){for(var a=[],b=[],c=0;c<this._vertex.length;c+=1)for(var e=this._vertex[c],d=e.get_faces(),h=0;h<d.length;h+=1)d[h].equals(this)||!this.has_vertex(e.next(d[h]))&&!this.has_vertex(e.prev(d[h]))||
b.includes(d[h].get_id())||(a.push(d[h]),b.push(d[h].get_id()));return a};this.get_faces_around=function(){for(var a=[],b=[],c=0;c<this._vertex.length;c+=1)for(var e=this._vertex[c].get_faces(),d=0;d<e.length;d+=1)e[d].equals(this)||b.includes(e[d].get_id())||(a.push(e[d]),b.push(e[d].get_id()));return a};this.get_neighbours_strlist=function(){for(var a="",b=this.get_neighbours(),c=0;c<b.length;c+=1)a+=b[c].get_name(),c<b.length-1&&(a+=", ");return a};this.assemble=function(){f._assembled||(f._assembled=
!0,f._neighbours=this.get_neighbours())};this.is_neighbour=function(a,b){this._assembled||this.assemble();if(a instanceof Array){b=!0;for(var c=0;c<a.length;c+=1)b=b&&this.is_neighbour(a[c],!1);return b&&a.length===this._neighbours.length}if(b)return 1===this._neighbours.length&&this._neighbours[0].equals(a);for(b=0;b<this._neighbours.length;b+=1)if(this._neighbours[b].equals(a))return!0;return!1};this.get_total_neighbours=function(){this._assembled||this.assemble();return this._neighbours.length};
this.is_cartesian_plane=function(){var a=this.get_normal(),b=a.getComponent(0),c=a.getComponent(1);a=a.getComponent(2);return 0!==b&&0===c&&0===a||0===b&&0!==c&&0===a||0===b&&0===c&&0!==a};this.get_vertices=function(){return this._vertex.slice(0)};this.get_threejs_points=function(a){for(var b=[],c=0;c<this.length();c+=1)b.push(this._vertex[c].get_pos(a));return b};this.generate_geometry=function(){var a=new THREE.Geometry,b=this.get_normal();b.normalize();if(3===this.length()){var c=[0,1,2];var e=
1}else{c=[];e=this.get_threejs_points(!1);var d=new THREE.Vector3(0,0,1),h=(new THREE.Quaternion).setFromUnitVectors(b,d),m=(new THREE.Quaternion).setFromUnitVectors(d,b);e.forEach(function(q){q.applyQuaternion(h)});for(var l,g,k,n=d=0,r=0,p=0;p<e.length;p+=1)l=e[p].getComponent(0),g=e[p].getComponent(1),k=e[p].getComponent(2),d=Math.min(l,d),n=Math.min(g,n),r=Math.min(k,r),c.push(l),c.push(g),c.push(k);for(l=0;l<e.length;l+=1)c[3*l]-=d,c[3*l+1]-=n,c[3*l+2]-=r;d=Math.abs(get_max_of_array(c));for(n=
0;n<c.length;n+=1)c[n]/=d;e.forEach(function(q){q.applyQuaternion(m)});c=earcut(c,null,3);e=c.length/3}if(0<e){for(d=0;d<this._vertex.length;d+=1)a.vertices.push(this._vertex[d].get_pos(!0));for(d=0;d<e;d+=1)a.faces.push(new THREE.Face3(c[3*d+2],c[3*d+1],c[3*d],b))}a.computeFaceNormals();a.computeVertexNormals();this._boxUnwrapUVs(a);return a};this._boxUnwrapUVs=function(a){a.boundingBox||a.computeBoundingBox();var b=a.boundingBox.getSize(new THREE.Vector3),c=a.boundingBox.min;if(0===a.faceVertexUvs[0].length)for(var e=
0;e<a.faces.length;e+=1)a.faceVertexUvs[0].push([new THREE.Vector2,new THREE.Vector2,new THREE.Vector2]);for(e=0;e<a.faces.length;e+=1){var d=a.faceVertexUvs[0][e],h=a.vertices[a.faces[e].a],m=a.vertices[a.faces[e].b],l=a.vertices[a.faces[e].c],g=(new THREE.Vector3).copy(m).sub(h),k=(new THREE.Vector3).copy(l).sub(h);g=(new THREE.Vector3).copy(g).cross(k);g.set(Math.abs(g.x),Math.abs(g.y),Math.abs(g.z));k=g.x>g.y?g.x>g.z?"x":g.y>g.z?"y":g.y>g.z:g.y>g.z?"y":"z";g="x"===k?"y":"x";k="x"===k?"z":"y"===
k?"z":"y";this._uv_flip?(d[0].set((h[k]-c[k])/b[k],(h[g]-c[g])/b[g]),d[1].set((m[k]-c[k])/b[k],(m[g]-c[g])/b[g]),d[2].set((l[k]-c[k])/b[k],(l[g]-c[g])/b[g])):(d[0].set((h[g]-c[g])/b[g],(h[k]-c[k])/b[k]),d[1].set((m[g]-c[g])/b[g],(m[k]-c[k])/b[k]),d[2].set((l[g]-c[g])/b[g],(l[k]-c[k])/b[k]));d[0].rotateAround(this._uv_center,this._uv_rotation);d[1].rotateAround(this._uv_center,this._uv_rotation);d[2].rotateAround(this._uv_center,this._uv_rotation);d[0].multiplyScalar(this._uv_scale);d[1].multiplyScalar(this._uv_scale);
d[2].multiplyScalar(this._uv_scale);d[0].add(this._uv_traslate);d[1].add(this._uv_traslate);d[2].add(this._uv_traslate)}a.elementsNeedUpdate=!0;a.verticesNeedUpdate=!0};this.remove=function(){for(var a=0;a<this._vertex.length;a+=1)this._vertex[a].remove_face(this)};this.check_vertices=function(){for(var a=0;a<this._vertex.length;a+=1)this._vertex[a].add_face(this)};this.add_volume=function(a){if(this.has_volume(a))return!1;this._volumes.push(a);return!0};this.has_volume=function(a){for(var b=0;b<
this._volumes.length;b+=1)if(this._volumes[b].equals(a))return!0;return!1};this.remove_volume=function(a){for(var b=0;b<this._volumes.length;b+=1)if(this._volumes[b].equals(a))return this._volumes.splice(b,1),!0;return!1};this.replace_vertex=function(a,b){for(var c=0;c<this._vertex.length;c+=1)if(this._vertex[c].equals(a))return this._vertex[c]=b,!0;return!1};this.set_uv_rotation=function(a){f._uv_rotation=a*Math.PI/180};this.enable_uv_flip=function(){f._uv_flip=!0};this.set_uv_scale=function(a){0===
a||0>a||(f._uv_scale=a)};this.set_uv_translate=function(a,b){f._uv_traslate.setX(-a);f._uv_traslate.setY(-b)};this.set_mesh=function(a){f._mesh=a};this.get_mesh=function(){return this._mesh};this._bomb=0;this._enabled=!0;this._played=!1;this._flag=0;this.behaviour={AROUND:1,NEIGHBOUR:0};this._bomb_behaviour=this.behaviour.NEIGHBOUR;this._exploded_secondary=this._exploded=!1;this.place_bomb=function(){f._bomb=-1};this.has_bomb=function(){return-1===f._bomb};this.set_bomb_count=function(a){f._bomb=
a};this.set_bomb_behaviour=function(a){f._bomb_behaviour=a};this.get_bomb_count=function(){if(!this.is_enabled())return 0;if(this._bomb_behaviour===this.behaviour.NEIGHBOUR)var a=this.get_neighbours();else if(this._bomb_behaviour===this.behaviour.AROUND)a=this.get_faces_around();else return 0;for(var b=0,c,e=0;e<a.length;e+=1)c=a[e],c.has_bomb()&&(b+=1);return b};this.disable_face=function(){f._enabled=!1};this.is_enabled=function(){return this._enabled};this.get_image=function(a,b){is_null_undf(b)&&
(b="");return this.is_enabled()?1===this._flag?a.images["flag"+b]:2===this._flag?a.images["question"+b]:this._played?this.has_bomb()?a.images["bomb"+b]:a.images["tile_"+f._bomb+b]:a.images["unopened"+b]:a.images["disabled"+b]};this.place_image=function(a){this._mesh.material.aoMap=this.get_image(a,"_ambient");this._mesh.material.bumpMap=this.get_image(a,"_normal");this._mesh.material.map=this.get_image(a,"");this._mesh.material.specularMap=this.get_image(a,"_specular")};this.play=function(a){f._played=
!0;f._mesh.material.color=a.palette.face_color_played;f._mesh.material.emissive=a.palette.face_unhover_played;f._mesh.material.shininess=a.palette.face_shininess_played};this.is_played=function(){return f._played||!f._enabled};this.get_target_faces=function(){switch(this._bomb_behaviour){case this.behaviour.NEIGHBOUR:return this.get_neighbours();case this.behaviour.AROUND:return this.get_faces_around();default:return[]}};this.place_flag=function(){f._flag=(f._flag+1)%3};this.has_flag=function(){return 1===
f._flag};this.has_question=function(){return 2===f._flag};this.explode=function(a){f._exploded=!0;f.play(a);f.place_image(a)};this.has_exploded=function(){return this._exploded};this.explode_secondary=function(a){f._exploded_secondary=!0;f._mesh.material.color=a.palette.face_exploded};this.has_exploded_secondary=function(){return f._exploded_secondary};this.get_center_coords=function(){for(var a={x:0,y:0,z:0},b=f._vertex[0].get_x(),c=b,e=f._vertex[0].get_y(),d=e,h=f._vertex[0].get_z(),m=h,l=1;l<f._vertex.length;l+=
1)b=Math.min(b,f._vertex[l].get_x()),e=Math.min(e,f._vertex[l].get_y()),h=Math.min(h,f._vertex[l].get_z()),c=Math.max(c,f._vertex[l].get_x()),d=Math.max(d,f._vertex[l].get_y()),m=Math.max(m,f._vertex[l].get_z());a.x=b+(c-b)/2;a.y=e+(d-e)/2;a.z=h+(m-h)/2;return a};this.disable_contour=function(){f._draw_contour=!1};this.has_contour=function(){return f._draw_contour};this.add_vertex(t);this.set_name(u)};
