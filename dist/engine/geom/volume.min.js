/*
 MIT
*/
function Volume(m,n){this._id=generateID();this._faces=[];this._last_added_faces=[];this._name="";this._strict=!1;this._total_vertices=this._vertices_duplicated=this._faces_deleted=0;this._add_check_vertices=this._add_check_faces=!0;var f=this;this.get_id=function(){return this._id};this.add_face=function(a,b){is_null_undf(b)&&(b=!1);b=b&&f._add_check_faces;if(is_null_undf(a))return!1;if(a instanceof Array){for(var c=!0,d=0;d<a.length;d+=1)c=c&&this.add_face(a[d],!0);f._last_added_faces=a;b||this._check_after_add_face();
return c}for(c=0;c<this._faces.length;c+=1)if(this._faces[c].equals(a))return!1;if(this._strict&&!a.is_valid())return app_console.error("[VOLUME] Face {0} ID {1} could not be added to volume, not valid".format(a.get_name(),a.get_id())),!1;f._add_check_vertices&&a.check_vertices();this._faces.push(a);a.add_volume(this);b||(f._last_added_faces=[a],this._check_after_add_face());return!0};this.has_face=function(a){if(a instanceof Array){for(var b=0;b<a.length;b+=1)if(!this.has_face(a[b]))return!1;return!0}for(b=
0;b<this._faces.length;b+=1)if(this._faces[b].equals(a))return!0;return!1};this.remove_face=function(a){if(a instanceof Array)for(var b=0;b<a.length;b+=1)this.remove_face(a[b]);else for(b=0;b<this._faces.length;b+=1)if(this._faces[b].equals(a)){this._faces.splice(b,1);break}};this.get_faces=function(a){is_null_undf(a)&&(a=!0);return a?this._faces.slice(0):this._faces};this.equals=function(a){return this._id===a._id};this.set_name=function(a){is_null_undf(a)||(f._name=a)};this.get_name=function(){return this._name};
this.get_vertices=function(){for(var a=[],b=[],c=0;c<this._faces.length;c+=1)for(var d=this._faces[c].get_vertices(),e=0;e<d.length;e+=1)b.includes(d[e].get_id())||(a.push(d[e]),b.push(d[e].get_id()));return a};this.has_vertex=function(a){var b=this.get_vertices();if(a instanceof Array){for(var c=!0,d=0;d<a.length;d+=1)c=c&&this._has_vertex(a[d],b);return c}return this._has_vertex(a,b)};this._has_vertex=function(a,b){for(var c=0;c<b.length;c+=1)if(b[c].equals(a))return!0;return!1};this.scale=function(a,
b,c,d){is_null_undf(b)&&(b=1);is_null_undf(c)&&(c=1);is_null_undf(d)&&(d=1);for(var e=this.get_vertices(),f=0;f<e.length;f+=1)e[f].scale(a,b,c,d)};this.translate=function(a,b,c){is_null_undf(a)&&(a=0);is_null_undf(b)&&(b=0);is_null_undf(c)&&(c=0);for(var d=this.get_vertices(),e=0;e<d.length;e+=1)d[e].translate(a,b,c)};this._get_vertices_last_added=function(){for(var a=[],b=[],c=0;c<f._last_added_faces.length;c+=1)for(var d=f._last_added_faces[c].get_vertices(),e=0;e<d.length;e+=1)b.includes(d[e].get_id())||
(a.push(d[e]),b.pushUnique(d[e].get_id()));return a};this._get_faces_around_last_added=function(){for(var a=this._get_vertices_last_added(),b=[],c=[],d=0;d<a.length;d+=1)for(var e=a[d].get_faces(),f=0;f<e.length;f+=1)!c.includes(e[f].get_id())&&e[f].has_volume(this)&&(b.push(e[f]),c.push(e[f].get_id()));return b};this._check_faces=function(){for(var a=[],b=this._get_faces_around_last_added(),c,d,e=0;e<f._last_added_faces.length;e+=1){c=f._last_added_faces[e];for(var k=0;k<b.length;k+=1)if(d=b[k],
!c.equals(d)&&d.has_vertex(c.get_vertices())){a.pushUnique(d.get_id());a.pushUnique(c.get_id());break}}for(b=0;b<this._faces.length;b+=1)a.includes(this._faces[b].get_id())&&(this._faces[b].remove(),this._faces[b].remove_volume(this),this._faces.splice(b,1),f._faces_deleted+=1,--b);for(b=0;b<this._last_added_faces.length;b+=1)a.includes(this._last_added_faces[b].get_id())&&(f._last_added_faces.splice(b,1),f._faces_deleted+=1,--b)};this._check_vertices=function(){for(var a=this.get_vertices(),b=[],
c=[],d,e,k=0;k<a.length;k+=1){d=a[k];for(var l=0;l<a.length;l+=1)if(e=a[l],!d.equals(e)&&e.equal_position(d)){for(var h=d.get_faces(),g=0;g<h.length;g+=1)c.includes(h[g].get_id())||(b.push(h[g]),c.push(h[g].get_id()));h=e.get_faces();for(g=0;g<h.length;g+=1)c.includes(h[g].get_id())||(b.push(h[g]),c.push(h[g].get_id()));d.join_replace(e);a.splice(l,1);--l;f._vertices_duplicated+=1}}f._total_vertices=a.length;f._last_added_faces=b;this._check_after_add_face()};this._check_after_add_face=function(){this._check_faces();
f._last_added_faces=[]};this.assemble=function(){this._check_vertices();for(var a=0;a<this._faces.length;a+=1)this._faces[a].assemble()};this.get_total_faces=function(a){if(a){for(var b=a=0;b<this._faces.length;b+=1)this._faces[b].is_enabled()&&(a+=1);return a}return this._faces.length};this.get_total_deleted_faces=function(){return this._faces_deleted};this.get_duplicated_vertices=function(){return this._vertices_duplicated};this.get_total_vertices=function(){return this._total_vertices};this.disable_face_check=
function(){f._add_check_faces=!1};this.disable_vertex_check=function(){f._add_check_vertices=!1};this.add_face(m);this.set_name(n)};
