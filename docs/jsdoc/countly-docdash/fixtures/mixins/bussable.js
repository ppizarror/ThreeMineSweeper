"use strict";var bus=require("postal");var Base=require("../base");var sys=require("lodash");var Bussable=Base.compose([Base],{declaredClass:"mixins/Bussable",constructor:function(){this._subscriptions={};this.log.trace("Bussable constructor")},subscribe:function(c,a,d){this.log.trace("Bussable subscribe");var b=bus.subscribe({channel:c,topic:a,callback:d});this.subscriptions[c+"."+a]=b;return b},once:function(c,a,d){this.log.trace("Bussable once");var b=this.subscribe(c,a,d);this.subscriptions[c+"."+a]=b;b.disposeAfter(1);return b},publish:function(c,b,a){this.log.trace("Bussable publish");bus.publish({channel:c,topic:b,data:a})},getSubscription:function(b,a){this.log.trace("Bussable getSubscription");return this.subscriptions[b+"."+a]},destroy:function(){this.log.trace("Bussable destroy");sys.each(this.subscriptions,function(a){a.unsubscribe()})}});module.exports=Bussable;